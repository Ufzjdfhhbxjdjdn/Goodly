
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>عرض المعاملات من عنوان</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: monospace;
      padding: 0;
      margin: 0;
    }
    #formatBar {
      background-color: #1c1c1c;
      padding: 5px 10px;
      border-top: 1px solid #333;
      font-size: 14px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 999;
    }
    #json {
      padding: 10px;
      white-space: pre-wrap;
      word-wrap: break-word;
      direction: ltr;
    }
    input[type="checkbox"] {
      margin-left: 6px;
    }
  </style>
</head>
<body>

  <div id="formatBar">
    <label>
      <input type="checkbox" id="toggleFormat" />
      عرض النص بتنسيق محسّن
    </label>
  </div>

  <pre id="json"></pre>

  <script>
    function getAddressFromPath() {
      const parts = window.location.pathname.split("/").filter(Boolean);
      if (
        parts.length >= 5 &&
        parts[0] === "api" &&
        parts[1] === "address" &&
        parts[3] === "txs" &&
        parts[4] === "chain"
      ) {
        return parts[2]; // العنوان في الجزء الثالث
      }
      return null;
    }

    const address = getAddressFromPath();
    const jsonElement = document.getElementById("json");
    let allTxs = [];
    let lastTxId = null;
    let formatted = false;

    if (!address) {
      jsonElement.textContent = "❌ لم يتم العثور على عنوان صالح في الرابط.";
    } else {
      const baseUrl = `https://blockstream.info/api/address/${address}/txs`;

      async function fetchAllTransactions() {
        let keepGoing = true;
        while (keepGoing) {
          let url = lastTxId ? baseUrl + "/chain/" + lastTxId : baseUrl;
          try {
            const res = await fetch(url);
            const data = await res.json();

            if (!Array.isArray(data) || data.length === 0) {
              keepGoing = false;
              break;
            }

            allTxs.push(...data);
            lastTxId = data[data.length - 1].txid;

            window.rawData = allTxs;
            renderData();

            await new Promise(resolve => setTimeout(resolve, 500));
          } catch (e) {
            console.error("خطأ في تحميل البيانات:", e);
            break;
          }
        }
      }

      function renderData() {
        if (formatted) {
          jsonElement.textContent = JSON.stringify(window.rawData, null, 2);
        } else {
          jsonElement.textContent = JSON.stringify(window.rawData);
        }
      }

      document.getElementById('toggleFormat').addEventListener('change', function () {
        formatted = this.checked;
        renderData();
      });

      fetchAllTransactions();
    }
  </script>

</body>
</html>
